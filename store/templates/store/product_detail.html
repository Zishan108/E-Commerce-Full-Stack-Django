{% extends 'store/base.html' %}

{% block title %}{{ product.name }} | Zishan Fashion{% endblock %}

{% block content %}
<div class="container-fluid px-0">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'store:home' %}">Home</a></li>
            <li class="breadcrumb-item"><a href="{% url 'store:category_products' product.category.slug %}">{{ product.category.name }}</a></li>
            <li class="breadcrumb-item active" aria-current="page">{{ product.name|truncatewords:3 }}</li>
        </ol>
    </nav>

    <div class="row g-5">
        <!-- Product Images Section -->
        <div class="col-lg-6">
            <div class="product-image-container">
                <div class="main-image mb-4 text-center">
                    {% if product.image %}
                    <img src="{{ product.image.url }}" class="img-fluid rounded-3 product-main-image" 
                         alt="{{ product.name }}" 
                         style="max-height: 500px; width: auto; object-fit: contain;">
                    {% else %}
                    <img src="https://via.placeholder.com/500x500?text=No+Image" 
                         class="img-fluid rounded-3 product-main-image" 
                         alt="No image" 
                         style="max-height: 500px; width: auto; object-fit: contain;">
                    {% endif %}
                </div>
                
                <!-- Additional image thumbnails (if available) -->
                <div class="image-thumbnails d-flex justify-content-center gap-3">
                    {% if product.image %}
                    <div class="thumbnail active">
                        <img src="{{ product.image.url }}" class="img-thumbnail" 
                             alt="{{ product.name }}" 
                             style="width: 80px; height: 80px; object-fit: cover; cursor: pointer;">
                    </div>
                    {% endif %}
                    <!-- You can add more thumbnails here if you have multiple images -->
                </div>
            </div>
        </div>

        <!-- Product Details Section -->
        <div class="col-lg-6">
            <div class="product-details-card card border-0 shadow-sm h-100">
                <div class="card-body p-4">
                    <!-- Category Badge -->
                    <div class="mb-3">
                        <span class="badge bg-primary bg-opacity-10 text-primary fs-6">
                            <a href="{% url 'store:category_products' product.category.slug %}" 
                               class="text-decoration-none">{{ product.category.name }}</a>
                        </span>
                    </div>

                    <!-- Product Title -->
                    <h1 class="h2 fw-bold mb-3">{{ product.name }}</h1>

                    <!-- Price -->
                    <div class="price-section mb-4">
                        <h2 class="text-success fw-bold display-6">₹{{ product.price }}</h2>
                        <p class="text-muted mb-0">Inclusive of all taxes</p>
                    </div>

                    <!-- Stock Status -->
                    <div class="stock-section mb-4">
                        {% if product.stock > 0 %}
                        <div class="d-flex align-items-center">
                            <i class="fas fa-check-circle text-success me-2"></i>
                            <span class="text-success fw-semibold">In Stock</span>
                            <span class="text-muted ms-2">({{ product.stock }} available)</span>
                        </div>
                        {% else %}
                        <div class="d-flex align-items-center">
                            <i class="fas fa-times-circle text-danger me-2"></i>
                            <span class="text-danger fw-semibold">Out of Stock</span>
                        </div>
                        {% endif %}
                    </div>

                    <!-- Description -->
                    <div class="description-section mb-4">
                        <h5 class="fw-semibold mb-3">Product Description</h5>
                        <p class="text-muted lh-lg">{{ product.description|default:"No description available for this product." }}</p>
                    </div>

                    <!-- Key Features -->
                    <div class="features-section mb-4">
                        <h5 class="fw-semibold mb-3">Key Features</h5>
                        <ul class="list-unstyled">
                            <li class="mb-2">
                                <i class="fas fa-check text-success me-2"></i>
                                <span>Premium Quality Material</span>
                            </li>
                            <li class="mb-2">
                                <i class="fas fa-check text-success me-2"></i>
                                <span>Latest Fashion Trend</span>
                            </li>
                            <li class="mb-2">
                                <i class="fas fa-check text-success me-2"></i>
                                <span>Comfortable Fit</span>
                            </li>
                            <li class="mb-2">
                                <i class="fas fa-check text-success me-2"></i>
                                <span>Easy Returns & Exchanges</span>
                            </li>
                        </ul>
                    </div>

                    <!-- Action Buttons -->
                    <div class="action-section mt-4">
                        {% if product.stock > 0 %}
                            {% if user.is_authenticated %}
                            <button type="button" class="btn btn-cart w-100 py-2 mb-3" 
                                    data-product-id="{{ product.id }}">
                                <i class="fas fa-shopping-cart me-2"></i>
                                Add to Cart
                            </button>
                            {% else %}
                            <a href="{% url 'users:login' %}?next={{ request.path }}" 
                               class="btn btn-primary w-100 py-2 mb-3">
                                <i class="fas fa-sign-in-alt me-2"></i>
                                Login to Add to Cart
                            </a>
                            {% endif %}
                        {% else %}
                            <button class="btn btn-secondary w-100 py-2 mb-3" disabled>
                                <i class="fas fa-times me-2"></i>
                                Out of Stock
                            </button>
                        {% endif %}

                        <!-- Additional Actions -->
                        <div class="d-grid gap-2">
                            <button class="btn btn-outline-dark py-2 share-btn">
                                <i class="fas fa-share-alt me-2"></i>
                                Share Product
                            </button>
                        </div>
                    </div>

                    <!-- Additional Info -->
                    <div class="additional-info mt-4 pt-4 border-top">
                        <div class="row text-center">
                            <div class="col-4">
                                <div class="info-item">
                                    <i class="fas fa-shipping-fast fa-2x text-primary mb-2"></i>
                                    <h6 class="fw-semibold mb-1">Free Shipping</h6>
                                    <small class="text-muted">Above ₹999</small>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="info-item">
                                    <i class="fas fa-undo-alt fa-2x text-primary mb-2"></i>
                                    <h6 class="fw-semibold mb-1">Easy Returns</h6>
                                    <small class="text-muted">30 Days Policy</small>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="info-item">
                                    <i class="fas fa-shield-alt fa-2x text-primary mb-2"></i>
                                    <h6 class="fw-semibold mb-1">Secure Payment</h6>
                                    <small class="text-muted">100% Protected</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Related Products Section -->
    <div class="row mt-5">
        <div class="col-12">
            <h3 class="fw-bold mb-4">You May Also Like</h3>
            <div class="row g-3">
                <!-- This would typically be populated with related products -->
                <div class="col-12 text-center py-4">
                    <p class="text-muted">Check out more products in the 
                        <a href="{% url 'store:category_products' product.category.slug %}" class="text-decoration-none">
                            {{ product.category.name }}
                        </a> category
                    </p>
                    <a href="{% url 'store:category_products' product.category.slug %}" 
                       class="btn btn-outline-primary">
                        View All {{ product.category.name }}
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.product-main-image {
    transition: transform 0.3s ease;
    border: 1px solid #e9ecef;
    padding: 10px;
    background: #fff;
}

.product-main-image:hover {
    transform: scale(1.02);
}

.product-details-card {
    background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
    border-radius: 15px;
}

.thumbnail {
    border: 2px solid transparent;
    border-radius: 8px;
    transition: all 0.3s ease;
}

.thumbnail.active {
    border-color: #ff6f61;
}

.thumbnail:hover {
    border-color: #ff6f61;
    transform: translateY(-2px);
}

.breadcrumb {
    background: transparent;
    padding: 0;
}

.breadcrumb-item a {
    color: #6c757d;
    text-decoration: none;
}

.breadcrumb-item a:hover {
    color: #ff6f61;
}

.breadcrumb-item.active {
    color: #495057;
}

.features-section li {
    padding: 0.3rem 0;
}

.action-section .btn {
    border-radius: 10px;
    font-weight: 600;
    transition: all 0.3s ease;
}

.action-section .btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}

.info-item {
    padding: 1rem;
    border-radius: 10px;
    transition: all 0.3s ease;
}

.info-item:hover {
    background: rgba(255, 111, 97, 0.05);
    transform: translateY(-2px);
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .product-main-image {
        max-height: 400px !important;
    }
    
    .display-6 {
        font-size: 2rem;
    }
    
    .product-details-card {
        margin-top: 2rem;
    }
}

@media (max-width: 576px) {
    .product-main-image {
        max-height: 300px !important;
    }
    
    .action-section .btn {
        padding: 0.8rem 1rem;
    }
    
    .info-item {
        padding: 0.5rem;
    }
    
    .info-item i {
        font-size: 1.5rem !important;
    }
}

/* Animation for cart alerts */
@keyframes slideInDown {
    from {
        transform: translateY(-100%);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

.alert {
    animation: slideInDown 0.3s ease;
}
</style>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function () {
    // Thumbnail click functionality (for future multiple images)
    const thumbnails = document.querySelectorAll('.thumbnail img');
    const mainImage = document.querySelector('.product-main-image');
    
    thumbnails.forEach(thumb => {
        thumb.addEventListener('click', function() {
            const src = this.getAttribute('src');
            mainImage.setAttribute('src', src);
            
            // Update active thumbnail
            thumbnails.forEach(t => t.parentElement.classList.remove('active'));
            this.parentElement.classList.add('active');
        });
    });

    // Share functionality
    const shareBtn = document.querySelector('.share-btn');
    if (shareBtn) {
        shareBtn.addEventListener('click', function() {
            if (navigator.share) {
                navigator.share({
                    title: '{{ product.name }}',
                    text: 'Check out this amazing product!',
                    url: window.location.href,
                })
                .catch(console.error);
            } else {
                // Fallback: copy to clipboard
                navigator.clipboard.writeText(window.location.href).then(() => {
                    // Use the global showAlert function from base.html
                    if (typeof showAlert === 'function') {
                        showAlert('Product link copied to clipboard!', 'info');
                    } else {
                        // Fallback if global function not available
                        const alertDiv = document.getElementById('cart-alert');
                        const alertEl = document.createElement('div');
                        alertEl.className = 'alert alert-info alert-dismissible fade show';
                        alertEl.innerHTML = `
                            <div class="d-flex align-items-center">
                                <i class="fas fa-link me-2"></i>
                                <div>Product link copied to clipboard!</div>
                                <button type="button" class="btn-close ms-auto" data-bs-dismiss="alert"></button>
                            </div>
                        `;
                        alertDiv.appendChild(alertEl);

                        setTimeout(() => {
                            if (alertEl.parentNode) {
                                alertEl.classList.remove('show');
                                setTimeout(() => alertEl.remove(), 300);
                            }
                        }, 3000);
                    }
                });
            }
        });
    }
});
</script>
{% endblock %}